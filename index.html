<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Interval Stopwatch</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { display:flex; flex-direction:column; justify-content:flex-start; align-items:center;
       min-height:100vh; margin:0; font-family:Arial,Helvetica,sans-serif;
       background:#000; color:#fff; padding-top:40px; }
#time { font-weight:bold; font-size:96px; background:rgba(0,0,0,0.2); padding:20px 40px;
        border-radius:20px; margin-bottom:20px; box-shadow:0 8px 20px rgba(0,0,0,0.3);
        text-align:center; }
.buttons { display:flex; justify-content:center; flex-wrap:wrap; gap:20px; margin-bottom:20px; }
button { font-family:Arial,Helvetica,sans-serif; font-weight:bold; font-size:18px;
         border:none; border-radius:9999px; cursor:pointer; transition:0.2s;
         box-shadow:0 4px 12px rgba(0,0,0,0.3); min-width:120px; height:50px;
         text-align:center; line-height:50px; }
#toggle { background-color:#00c851; color:#fff; }
#toggle:hover { background-color:#007e33; }
#reset { background-color:#33b5e5; color:#fff; }
#reset:hover { background-color:#0099cc; }
#lap { background-color:#ffbb33; color:#000; }
#lap:hover { background-color:#ffaa00; }
#laps { margin-top:20px; width:90%; max-width:400px; list-style:none; padding:0; }
#laps li { background:rgba(255,255,255,0.1); margin-bottom:6px; padding:8px 12px;
           border-radius:12px; font-size:16px; display:flex; justify-content:space-between;
           word-break:break-word; }
</style>
</head>
<body>

<div id="time">00:00</div>
<div class="buttons">
    <button id="reset">Reset</button>
    <button id="toggle">Start</button>
    <button id="lap">Lap</button>
</div>
<ul id="laps"></ul>

<script>
let startTime = null;
let elapsedBefore = 0;
let interval = null;
let lastBeep = -1;
let laps = [];
const beepInterval = 30; // 秒ごとに鳴らす

const timeDisplay = document.getElementById('time');
const toggleButton = document.getElementById('toggle');
const lapButton = document.getElementById('lap');
const resetButton = document.getElementById('reset');
const lapsList = document.getElementById('laps');

// Audio 要素を使用（特別な操作なし）
const beepAudio = new Audio('beep.mp3');

function updateTime() {
    if (!startTime) return;
    const now = Date.now();
    const elapsed = Math.floor((now - startTime)/1000) + elapsedBefore;
    timeDisplay.textContent = `${String(Math.floor(elapsed/60)).padStart(2,'0')}:${String(elapsed%60).padStart(2,'0')}`;

    // 表示に同期してビープ
    if (elapsed % beepInterval === 0 && elapsed !== lastBeep) {
        beepAudio.currentTime = 0;
        beepAudio.play().catch(()=>{}); // タブ非アクティブなら鳴らない自然挙動
        lastBeep = elapsed;
    }
}

function renderLaps() {
    lapsList.innerHTML = '';
    laps.forEach((lap,i)=>{
        const li = document.createElement('li');
        li.textContent = `Lap ${i+1} - ${lap.elapsed} (${lap.timestamp})`;
        lapsList.appendChild(li);
    });
}

function startInterval() {
    if (!interval) {
        startTime = Date.now();
        interval = setInterval(updateTime, 200); // 0.2秒ごとに更新
        toggleButton.textContent = "Stop";
        toggleButton.style.backgroundColor = "#ff4444";
    }
}

function stopInterval() {
    if (interval) {
        clearInterval(interval);
        interval = null;
        elapsedBefore += Math.floor((Date.now()-startTime)/1000);
        startTime = null;
        toggleButton.textContent = "Start";
        toggleButton.style.backgroundColor = "#00c851";
    }
}

toggleButton.addEventListener('click', ()=>{
    if(interval) stopInterval();
    else startInterval();
});

lapButton.addEventListener('click', ()=>{
    const now = new Date();
    // 経過秒を計算
    const elapsed = elapsedBefore + (startTime ? Math.floor((Date.now()-startTime)/1000) : 0);
    const minutes = Math.floor(elapsed / 60);
    const seconds = elapsed % 60;
    const timeStr = `${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
    const lapEntry = {
        elapsed: timeStr,
        timestamp: now.toLocaleTimeString([], {hour12:false})
    };
    laps.push(lapEntry);
    renderLaps();
});

resetButton.addEventListener('click', ()=>{
    stopInterval();
    elapsedBefore = 0;
    lastBeep = -1;
    timeDisplay.textContent = "00:00";
    laps = [];
    renderLaps();
});
</script>

</body>
</html>